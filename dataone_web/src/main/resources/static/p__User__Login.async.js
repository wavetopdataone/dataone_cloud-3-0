(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{Y5yc:function(e,t,a){"use strict";a.r(t),function(e){a("sRBo");var o,n=a("kaz8"),r=(a("miYZ"),a("tsqr")),i=(a("2qtc"),a("kLXV")),l=(a("5NDa"),a("5rEg")),s=(a("fOrg"),a("+KLJ")),d=a("2Taf"),u=a.n(d),c=a("vZ4D"),m=a.n(c),h=a("l4Ni"),f=a.n(h),g=a("ujKo"),p=a.n(g),b=a("MhPg"),C=a.n(b),v=a("q1tI"),y=a.n(v),N=a("WsrF"),S=(a("XlDN"),a("vDqi")),k=a.n(S),w=a("jHKv"),M=(a("kQFk"),a("vZRL")),E=a("QBZU"),I=a("xKgJ"),x=a("eTk0"),F=a("w2qy"),P=a.n(F),T=E.a.UserName,R=E.a.Password,L=E.a.Code,_=E.a.Submit,D=(E.a.Captcha,N.a.create()(function(e){function t(e){var a;return u()(this,t),(a=f()(this,p()(t).call(this,e))).state={},a}return C()(t,e),m()(t,[{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onCancel,o=e.onCreate,n=e.form.getFieldDecorator;return y.a.createElement(i.a,{visible:t,title:"绑定系统邮箱",okText:"确认",onCancel:a,onOk:o,bodyStyle:{padding:0},closable:!1,cancelButtonProps:{disabled:!0}},y.a.createElement(s.a,{message:"说明：绑定系统邮箱后会自动抓取系统内所有任务的数据任务错误信息、错误队列预警、错误队列暂停、数据源变化通知，上述消息会通过系统邮箱发送至各个任务的参与人邮箱",banner:!0,showIcon:!1,style:{color:"#408AFF",background:"#F5F9FD",padding:"15px",marginBottom:10,fontSize:12}}),y.a.createElement(N.a,null,y.a.createElement(N.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"新邮箱"},n("email",{rules:[{required:!0,type:"email",message:"请输入正确格式的邮箱"}]})(y.a.createElement(l.a,{type:"email",placeholder:"请输入新邮箱地址"}))),y.a.createElement(N.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"邮箱授权码"},n("emailPassword",{rules:[{required:!0,message:"请输入正确的邮箱授权码"}]})(y.a.createElement(l.a,{type:"password",placeholder:"请输入正确的邮箱密码"})))))}}]),t}(y.a.Component))),j=N.a.create()(o=function(t){function a(t){var o;return u()(this,a),(o=f()(this,p()(a).call(this,t))).handleCreate=function(){o.formRef.props.form.validateFields(function(e,t){e||o.handleAdd(t)})},o.handleAdd=function(t){var a=e.constants.httpType+e.constants.website+"/sys_user/bindEmail/";k()({method:"post",url:a,data:w.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if(1==e.data.status)r.a.success("操作成功",2),window.location.href="/busList";else if(0==e.data.status)return void r.a.error(e.data.message,2);o.setState({visible:!1,visiblePassword:!1,visibleEmail:!1})}).catch(function(e){})},o.saveFormRef=function(e){o.formRef=e},o.loadName=function(){"yes"==localStorage.getItem("ifChecked")&&o.setState({userName:"undefined"==localStorage.getItem("userName")?"":localStorage.getItem("userName")})},o.handleSubmit=function(t,a){o.state.checked?(localStorage.setItem("ifChecked","yes"),localStorage.setItem("userName",a.userName)):localStorage.setItem("ifChecked","no");var n={name:a.userName,password:a.password},i=localStorage.getItem("vcode").toLocaleLowerCase();o.child.update(),t||(a.code.toLocaleLowerCase()!==i?(r.a.error("验证码不正确",2),o.loginForm.resetFields("code",[]),o.setState({vcode:""})):k()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/login/",data:w.a.Amap(n)}).then(function(e){if(1==e.data.status){if(localStorage.setItem("userName",e.data.data[0].user_name),localStorage.setItem("userId",e.data.data[0].user_id),localStorage.setItem("role_id",e.data.data[0].role_id),localStorage.setItem("authToken",e.data.authToken),localStorage.setItem("dept_id",e.data.data[0].dept_id),localStorage.setItem("role_key",e.data.data[0].role_key),1==e.data.data[0].role_id){if(Object(I.b)("admin"),Object(x.b)(),localStorage.setItem("authority","admin"),0==e.data.check)return void o.setState({visibleEmail:!0})}else 2==e.data.data[0].role_id?(Object(I.b)("usermanage"),Object(x.b)(),localStorage.setItem("authority","usermanage")):3==e.data.data[0].role_id&&(Object(I.b)("editor"),Object(x.b)(),localStorage.setItem("authority","editor"));window.location.href="/busList",r.a.success("登录成功",2)}else if(2==e.data.status){var t="密码不正确，您还有".concat(e.data.lefttime,"次机会");r.a.error(t,2),o.loginForm.resetFields()}else if(400==e.data.status){var a,n,i,l=e.data.date.slice(0,e.data.date.length-3),s=String((new Date).getTime()).slice(0,String((new Date).getTime()).length-3),d=Number(l)+300;if(d>Number(s)){var u=d-Number(s);u>=0&&(n=Math.floor(u/60),i=Math.floor(u%60),0==n?a="请"+i+"秒后重新登录":(i<10&&(i="0"+Math.floor(u%60)),a="请"+n+"分"+i+"秒后重新登录")),r.a.error(a,2)}}else r.a.error(e.data.message,2),o.loginForm.resetFields()}).catch(function(e){}))},o.forgetPas=function(){window.location.href="/register"},o.onChange=function(e){o.setState({checked:e.target.checked})},o.onRef=function(e){o.child=e},o.state={url:"",context:"获取验证码",visiable:"false",checked:!0,userName:"",visibleEmail:!1},o}return C()(a,t),m()(a,[{key:"componentDidMount",value:function(){this.loadName()}},{key:"render",value:function(){var e=this,t=this.props,a=(t.login,t.submitting);t.form;return y.a.createElement("div",{className:P.a.main,style:{top:"calc(50% - 131px)",position:"fixed",left:"60%",width:300}},y.a.createElement(E.a,{onSubmit:this.handleSubmit,ref:function(t){e.loginForm=t}},y.a.createElement(T,{autoComplete:"off",name:"userName",placeholder:"请输入用户名",style:{background:"none",marginBottom:"10px"},defaultValue:this.state.userName}),y.a.createElement(R,{style:{background:"none",marginBottom:"10px"},name:"password",placeholder:"请输入密码",onPressEnter:function(){return e.loginForm.validateFields(e.handleSubmit)}}),y.a.createElement(L,{autoComplete:"off",name:"code",style:{background:"none",marginBottom:"10px"},placeholder:"请输入验证码",onPressEnter:function(){return e.loginForm.validateFields(e.handleSubmit)}}),y.a.createElement(M.a,{onRef:this.onRef}),y.a.createElement(n.a,{onChange:this.onChange,checked:this.state.checked,style:{color:"#fff"}},"记住用户名"),y.a.createElement("a",{onClick:this.forgetPas,style:{float:"right"}},"忘记密码"),y.a.createElement(_,{loading:a},"登录"),this.state.visibleEmail?y.a.createElement(D,{wrappedComponentRef:this.saveFormRef,visible:this.state.visibleEmail,onCancel:this.handleCancel,ifCreat:!1,onCreate:function(){return e.handleCreate()},formValues:this.state.formValues}):null))}}]),a}(v.Component))||o;t.default=j}.call(this,a("yLpj"))},vZRL:function(e,t,a){"use strict";var o=a("2Taf"),n=a.n(o),r=a("vZ4D"),i=a.n(r),l=a("l4Ni"),s=a.n(l),d=a("ujKo"),u=a.n(d),c=a("MhPg"),m=a.n(c),h=a("q1tI"),f=a.n(h),g=(a("17x9"),function(e){function t(e){var a;return n()(this,t),(a=s()(this,u()(t).call(this,e))).randomNum=function(e,t){return Math.floor(Math.random()*(t-e)+e)},a.update=function(){a.drawPic();for(var e=[],t=0;t<4;t++){var o=a.randomNum(0,9);o<3?e.push(a.randomNum(0,10)):o>=3&&o<=6?e.push(a.getUpperCharacter()):o>6&&e.push(a.getLowerCharacter())}a.setState({identifyCode:e});var n="";a.state.identifyCode.forEach(function(e,t){n+=String(e)}),localStorage.setItem("vcode",n)},a.getLowerCharacter=function(){return a.getCharacter("lower")},a.getUpperCharacter=function(){return a.getCharacter("upper")},a.getCharacter=function(e){var t="";return"lower"===e&&(t=String.fromCharCode(Math.floor(26*Math.random())+"a".charCodeAt(0))),"upper"===e&&(t=String.fromCharCode(Math.floor(26*Math.random())+"A".charCodeAt(0))),t},a.state={identifyCode:[a.randomNum(0,10),a.getUpperCharacter(),a.randomNum(0,10),a.randomNum(0,10)],fontSizeMin:{type:Number,default:24},fontSizeMax:{type:Number,default:30},backgroundColorMin:{type:Number,default:180},backgroundColorMax:{type:Number,default:240},colorMin:{type:Number,default:50},colorMax:{type:Number,default:170},lineColorMin:{type:Number,default:30},lineColorMax:{type:Number,default:180},dotColorMin:{type:Number,default:0},dotColorMax:{type:Number,default:255},contentWidth:{type:Number,default:140},contentHeight:{type:Number,default:40}},a}return m()(t,e),i()(t,[{key:"componentDidMount",value:function(){this.props.onRef&&this.props.onRef(this),this.update(),this.props.onRef(this)}},{key:"watchChild",value:function(e){var t=this;this.setState({identifyCode:e},function(){t.drawPic()})}},{key:"randomColor",value:function(e,t){return"rgb("+this.randomNum(e,t)+","+this.randomNum(e,t)+","+this.randomNum(e,t)+")"}},{key:"drawPic",value:function(){var e=document.getElementById("s-canvas").getContext("2d");e.textBaseline="bottom",e.fillStyle=this.randomColor(255,255),e.fillRect(0,0,this.state.contentWidth.default,this.state.contentHeight.default);for(var t=0;t<this.state.identifyCode.length;t++)this.drawText(e,this.state.identifyCode[t],t)}},{key:"drawText",value:function(e,t,a){e.fillStyle=this.randomColor(this.state.colorMin.default,this.state.colorMax.default),e.font=this.randomNum(this.state.fontSizeMin.default,this.state.fontSizeMax.default)+"px SimHei";var o=(a+1)*(140/(this.state.identifyCode.length+1)),n=this.randomNum(this.state.fontSizeMax.default,this.state.contentHeight.default-5),r=this.randomNum(-45,45);e.translate(o,n),e.rotate(r*Math.PI/180),e.fillText(t,0,0),e.rotate(-r*Math.PI/180),e.translate(-o,-n)}},{key:"drawLine",value:function(e){for(var t=0;t<8;t++)e.strokeStyle=this.randomColor(this.state.lineColorMin.default,this.state.lineColorMax.default),e.beginPath(),e.moveTo(this.randomNum(0,this.state.contentWidth.default),this.randomNum(0,this.state.contentHeight.default)),e.lineTo(this.randomNum(0,this.state.contentWidth.default),this.randomNum(0,this.state.contentHeight.default)),e.stroke()}},{key:"drawDot",value:function(e){for(var t=0;t<100;t++)e.fillStyle=this.randomColor(0,255),e.beginPath(),e.arc(this.randomNum(0,this.state.contentWidth.default),this.randomNum(0,this.state.contentHeight.default),1,0,2*Math.PI),e.fill()}},{key:"render",value:function(){return f.a.createElement("canvas",{onClick:this.update,height:this.state.contentHeight.default,id:"s-canvas",style:{float:"right"},width:this.state.contentWidth.default})}}]),t}(h.Component));t.a=g}}]);