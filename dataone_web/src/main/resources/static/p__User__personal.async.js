(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{RJM5:function(e,a,t){"use strict";t.r(a),function(e){t("IzEo");var s=t("bx4M"),n=(t("miYZ"),t("tsqr")),l=(t("fOrg"),t("+KLJ")),r=(t("5NDa"),t("5rEg")),i=(t("2qtc"),t("kLXV")),o=t("2Taf"),c=t.n(o),m=t("vZ4D"),d=t.n(m),p=t("l4Ni"),u=t.n(p),h=t("ujKo"),f=t.n(h),w=t("MhPg"),E=t.n(w),g=(t("y8nQ"),t("Vl3Y")),v=(t("Pwec"),t("CtXQ")),b=(t("aHsQ"),t("sGsY")),C=(t("B9cy"),t("Ol7k")),y=t("q1tI"),S=t.n(y),k=t("vDqi"),_=t.n(k),I=t("jHKv"),F=(t("kQFk"),t("gtCd")),x=t.n(F),B=C.a.Content,N=b.a.Countdown,P=v.a.createFromIconfontCN({scriptUrl:e.constants.iconUrl}),V=g.a.create()(function(e){function a(e){var t;return c()(this,a),(t=u()(this,f()(a).call(this,e))).state={email:e.formValues.email,userId:e.formValues.user_id},t}return E()(a,e),d()(a,[{key:"render",value:function(){var e=this.props,a=e.visible,t=e.onCancel,s=e.onCreate,n=e.form.getFieldDecorator;return S.a.createElement(i.a,{visible:a,title:"修改邮箱",okText:"确认",onCancel:t,onOk:s,width:600},S.a.createElement(g.a,null,S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"邮箱"},n("email",{rules:[{required:!0,message:"Please input your username!"}],initialValue:this.state.email})(S.a.createElement(r.a,{disabled:!0}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"密码验证"},n("password",{validate:[{trigger:"onBlur",rules:[{required:!0,pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,message:"密码限8-20个字符，且同时包含大小写字母",min:8,max:20}]}]})(S.a.createElement(r.a.Password,{type:"password",placeholder:"请输入dataone登录密码"}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"新邮箱"},n("newEmail",{validate:[{trigger:"onBlur",rules:[{required:!0,whitespace:!0,message:"邮箱不能为空，请输入邮箱地址"},{type:"email",message:"您输入的邮箱格式错误，请重新输入！"}]}]})(S.a.createElement(r.a,{type:"email",placeholder:"请输入新邮箱地址"}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"确认邮箱"},n("newEmail2",{validate:[{trigger:"onBlur",rules:[{required:!0,whitespace:!0,message:"邮箱不能为空，请输入邮箱地址"},{type:"email",message:"您输入的邮箱格式错误，请重新输入！"}]}]})(S.a.createElement(r.a,{type:"email",placeholder:"请再次确认新邮箱地址"})))))}}]),a}(S.a.Component)),T=g.a.create()(function(e){function a(e){var t;return c()(this,a),(t=u()(this,f()(a).call(this,e))).state={email:e.formValues.email,userId:e.formValues.user_id},t}return E()(a,e),d()(a,[{key:"render",value:function(){var e=this.props,a=e.visible,t=e.onCancel,s=e.onCreate,n=e.form.getFieldDecorator;return S.a.createElement(i.a,{visible:a,title:"修改系统邮箱",okText:"确认",onCancel:t,onOk:s,bodyStyle:{padding:0},width:600},S.a.createElement(l.a,{message:S.a.createElement("div",{style:{color:"rgba(64, 138, 255, 0.7)",fontSize:14}},S.a.createElement(P,{type:"iconwenhao1"}),S.a.createElement("span",null,"『修改邮箱』: 1.绑定系统邮箱后会自动抓取系统内所有任务的数据任务错误信息、错误队列预警、错误队列暂停、数据源变化通知，上述消息会通过系统邮箱发送至各个任务的参与人邮箱 2.请准确填写邮箱授权码，否则将导致消息无法发送至参与人邮箱")),banner:!0,showIcon:!1,style:{color:"#408AFF",background:"#F5F9FD",padding:"15px",marginBottom:10,fontSize:12}}),S.a.createElement(g.a,null,S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"邮箱"},n("email",{initialValue:this.state.email,validateFirst:!0,validate:[{trigger:"onBlur",rules:[{required:!0,whitespace:!0,message:"邮箱不能为空，请输入邮箱地址"},{type:"email",message:"您输入的邮箱格式错误，请重新输入！"}]}]})(S.a.createElement(r.a,{disabled:!0}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"密码验证"},n("password",{validate:[{trigger:"onBlur",rules:[{required:!0,pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,message:"密码限8-20个字符，且同时包含大小写字母",min:8,max:20}]}]})(S.a.createElement(r.a.Password,{type:"password",placeholder:"请输入dataone登录密码"}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"新邮箱"},n("newEmail",{validate:[{trigger:"onBlur",rules:[{required:!0,whitespace:!0,message:"邮箱不能为空，请输入邮箱地址"},{type:"email",message:"您输入的邮箱格式错误，请重新输入！"}]}]})(S.a.createElement(r.a,{type:"email",placeholder:"请输入新邮箱地址"}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"邮箱授权码"},n("emailPassword",{validate:[{trigger:"onBlur",rules:[{required:!0,message:"邮箱授权码必填"}]}]})(S.a.createElement(r.a.Password,{type:"password",placeholder:"请输入正确的邮箱授权码"})))))}}]),a}(S.a.Component)),q=g.a.create()(function(e){function a(){return c()(this,a),u()(this,f()(a).apply(this,arguments))}return E()(a,e),d()(a,[{key:"render",value:function(){var e=this.props,a=e.visible,t=e.onCancel,s=e.onCreate,n=e.form.getFieldDecorator;return S.a.createElement(i.a,{visible:a,title:"修改密码",okText:"确认",onCancel:t,onOk:s,width:600},S.a.createElement(g.a,null,S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"原密码"},n("password",{validate:[{trigger:"onBlur",rules:[{required:!0,pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,message:"密码限8-20个字符，且同时包含大小写字母",min:8,max:20}]}]})(S.a.createElement(r.a.Password,{type:"password",placeholder:"请输入原密码"}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"新密码"},n("newPassword",{validate:[{trigger:"onBlur",rules:[{required:!0,pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,message:"密码限8-20个字符，且同时包含大小写字母",min:8,max:20}]}]})(S.a.createElement(r.a.Password,{type:"password",placeholder:"请输入新密码"}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"确认密码"},n("newPassword2",{validate:[{trigger:"onBlur",rules:[{required:!0,pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,message:"密码限8-20个字符，且同时包含大小写字母",min:8,max:20}]}]})(S.a.createElement(r.a.Password,{type:"password",placeholder:"请再次输入新密码"})))))}}]),a}(S.a.Component)),D=g.a.create()(function(a){function t(a){var s;return c()(this,t),(s=u()(this,f()(t).call(this,a))).onFinish=function(){s.setState({verification:!0,reload:!1})},s.getverification=function(){var a={email:s.state.value};_()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/sendCode",headers:{authToken:localStorage.getItem("authToken")},data:I.a.Amap(a)}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status?(s.setState({verification:!1,deadline:Date.now()+6e4}),n.a.success("验证码已发送至您的邮箱，请到邮箱中获取")):n.a.error(e.data.message)}).catch(function(e){})},s.state={verification:!0,skill_email:a.formValues.skill_email,userId:a.formValues.user_id,deadline:Date.now()+6e4,color:!1,reload:!0,value:""},s}return E()(t,a),d()(t,[{key:"render",value:function(){var e=this,a=this.props,t=a.visible,s=a.onCancel,n=a.onCreate,o=a.form,c=o.getFieldDecorator,m=(o.getFieldsError,o.getFieldError),d=void 0==((0,o.isFieldTouched)("email")&&m("email"));return S.a.createElement(i.a,{visible:t,title:"修改技术支持邮箱",okText:"确认",onCancel:s,onOk:n,width:600,bodyStyle:{padding:0},className:x.a.countDown},S.a.createElement(l.a,{message:S.a.createElement("div",{style:{color:"rgba(64, 138, 255, 0.7)",fontSize:14}},S.a.createElement(P,{type:"iconwenhao1"}),S.a.createElement("span",null,"『技术支持』邮箱默认为dataone团队邮箱，当用户无法解决『消息列表』内通知任务异常时，可通过此邮箱联系dataone团队，邮箱地址可根据实际情况修改 ")),banner:!0,showIcon:!1,style:{color:"#408AFF",background:"#F5F9FD",padding:"15px",marginBottom:10,fontSize:12}}),S.a.createElement(g.a,null,S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"原邮箱地址"},c("oldEmail",{rules:[{required:!0,message:"Please input your username!"}],initialValue:this.state.skill_email})(S.a.createElement(r.a,{disabled:!0}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"新邮箱"},c("email",{validate:[{trigger:"onBlur",rules:[{required:!0,whitespace:!0,message:"邮箱不能为空，请输入邮箱地址"},{type:"email",message:"您输入的邮箱格式错误，请重新输入！"}]}]})(S.a.createElement(r.a,{type:"email",placeholder:"请输入新邮箱地址",onChange:function(a){return e.setState({value:a.target.value,color:!!a.target.value})}}))),S.a.createElement(g.a.Item,{labelCol:{span:6},wrapperCol:{span:14},label:"验证码"},c("authCode",{rules:[{required:!0,message:"请输入验证码"}]})(S.a.createElement(r.a,{suffix:S.a.createElement("div",null,S.a.createElement("a",{type:"primary",onClick:d&&this.state.color?this.getverification:null,style:{float:"right",width:70,padding:0,textAlign:"center",color:d&&this.state.color?"#1890FF":"#a7abb9",height:40,lineHeight:"40px",display:this.state.verification?"block":"none"}},this.state.reload?"获取验证码":"重新发送"),S.a.createElement(N,{style:{float:"right",width:120,height:40,fontSize:14,textAlign:"center",display:this.state.verification?"none":"block",cursor:"pointer"},format:"重新发送(s秒)",value:0==this.state.verification?this.state.deadline:null,onFinish:this.onFinish})),type:"code",placeholder:"请输入验证码"})))))}}]),t}(S.a.Component)),A=function(a){function t(){var a;return c()(this,t),(a=u()(this,f()(t).apply(this,arguments))).state={selectItem:"1",stepValue:"1",dept_name:"",user_name:1==localStorage.getItem("role_id")?"admin":""},a.personal=function(){_()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/personal/",headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),a.setState({formValues:e.data.data,user_name:e.data.data.user_name,dept_name:e.data.data.dept_name,count_job:e.data.data.count_job,email:e.data.data.email,user_id:e.data.data.user_id,password:e.data.data.password,emailSupport:e.data.data.skill_email})}).catch(function(e){})},a.onChange=function(){a.setState({stepValue:"2"})},a.showModal=function(e){1==e?a.setState({visible:!0}):2==e?a.setState({visiblePassword:!0}):3==e?a.setState({visibleEmail:!0}):4==e&&a.setState({visibleEmailSupport:!0})},a.handleCancel=function(){a.setState({visible:!1,visiblePassword:!1,visibleEmail:!1,visibleEmailSupport:!1})},a.saveFormRef=function(e){a.formRef=e},a.handleCreate=function(){a.formRef.props.form.validateFields(function(e,t){e||(void 0==t.newEmail||void 0==t.newEmail2||t.newEmail==t.newEmail2?void 0==t.newPassword||t.newPassword==t.newPassword2?a.handleAdd(t):n.a.error("两次密码不一致！"):n.a.error("两次邮箱不一致！"))})},a.handleAdd=function(t){var s=e.constants.httpType+e.constants.website+"/sys_user/updUserEmail/";t.userId=a.state.user_id,void 0!=t.newEmail2&&(delete t.newEmail2,delete t.email),void 0!=t.emailPassword&&(delete t.email,s=e.constants.httpType+e.constants.website+"/sys_user/updSuperEmail/"),void 0!=t.newPassword&&(delete t.newPassword2,s=e.constants.httpType+e.constants.website+"/sys_user/updPassword/"),void 0!=t.email&&(delete t.oldEmail,delete t.userId,s=e.constants.httpType+e.constants.website+"/sys_user/skillCodeEquals"),_()({method:"post",url:s,data:I.a.Amap(t),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){if("401"==e.data.status&&(window.location.href="/user"),1==e.data.status){if(n.a.success("操作成功"),void 0!=t.newPassword)return void(window.location.href="/");a.personal()}else if(0==e.data.status)return void n.a.error(e.data.message);a.setState({visible:!1,visiblePassword:!1,visibleEmail:!1,visibleEmailSupport:!1})}).catch(function(e){})},a.addSubmit=function(t){delete t.password1;var s=2;3==a.state.role_id&&(s=3),_()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_user/addUser/?id="+s,data:t,headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status?(n.a.success("操作成功"),a.setState({userid:e.data.id,stepValue:"2"})):n.a.error(e.data.message)}).catch(function(e){})},a}return E()(t,a),d()(t,[{key:"componentDidMount",value:function(){this.personal()}},{key:"render",value:function(){var e=this;return S.a.createElement(C.a,{className:x.a.layoutBox},S.a.createElement(B,{style:{background:"#fff",padding:24,minHeight:280}},S.a.createElement(s.a,{title:"个人设置"},S.a.createElement("div",{className:x.a.personalBox},S.a.createElement("p",null,S.a.createElement("span",{className:x.a.firstSpan},"用户名 :"),S.a.createElement("span",{className:x.a.emailBox},S.a.createElement("span",{className:x.a.secondSpan,title:this.state.user_name},this.state.user_name.length>20?this.state.user_name.substring(0,20)+"...":this.state.user_name))),S.a.createElement("p",{style:{display:1==localStorage.getItem("role_id")?"none":"block"}},S.a.createElement("span",{className:x.a.firstSpan},"小组 :"),S.a.createElement("span",{className:x.a.emailBox},S.a.createElement("span",{className:x.a.secondSpan,title:this.state.dept_name},this.state.dept_name.length>20?this.state.dept_name.substring(0,20)+"...":this.state.dept_name))),S.a.createElement("p",{style:{display:1==localStorage.getItem("role_id")?"none":"block"}},S.a.createElement("span",{className:x.a.firstSpan},"已参与任务数 :"),S.a.createElement("span",{className:x.a.emailBox},S.a.createElement("span",{className:x.a.secondSpan},this.state.count_job))),S.a.createElement("p",{style:{display:1==localStorage.getItem("role_id")?"block":"none"}},S.a.createElement("span",{className:x.a.firstSpan},"系统邮箱:"),S.a.createElement("span",{className:x.a.emailBox},S.a.createElement("span",{className:x.a.secondSpan},this.state.email),S.a.createElement(v.a,{type:"edit",onClick:function(){return e.showModal(3)}}))),S.a.createElement("p",{style:{display:1==localStorage.getItem("role_id")?"none":"block"}},S.a.createElement("span",{className:x.a.firstSpan},"邮箱:"),S.a.createElement("span",{className:x.a.emailBox},S.a.createElement("span",{className:x.a.secondSpan},this.state.email),S.a.createElement(v.a,{type:"edit",onClick:function(){return e.showModal(1)}}))),S.a.createElement("p",null,S.a.createElement("span",{className:x.a.firstSpan},"密码 :"),S.a.createElement("span",{className:x.a.emailBox},S.a.createElement("span",{className:x.a.secondSpan},"******"),S.a.createElement(v.a,{type:"edit",onClick:function(){return e.showModal(2)}}))),S.a.createElement("p",{style:{display:1==localStorage.getItem("role_id")?"block":"none"}},S.a.createElement("span",{className:x.a.firstSpan},"技术支持邮箱:"),S.a.createElement("span",{className:x.a.emailBox},S.a.createElement("span",{className:x.a.secondSpan},this.state.emailSupport),S.a.createElement(v.a,{type:"edit",onClick:function(){return e.showModal(4)}})))),this.state.visible?S.a.createElement(V,{wrappedComponentRef:this.saveFormRef,visible:this.state.visible,onCancel:this.handleCancel,ifCreat:!1,onCreate:function(){return e.handleCreate()},formValues:this.state.formValues}):null,this.state.visibleEmail?S.a.createElement(T,{wrappedComponentRef:this.saveFormRef,visible:this.state.visibleEmail,onCancel:this.handleCancel,ifCreat:!1,onCreate:function(){return e.handleCreate()},formValues:this.state.formValues}):null,this.state.visibleEmailSupport?S.a.createElement(D,{wrappedComponentRef:this.saveFormRef,visible:this.state.visibleEmailSupport,onCancel:this.handleCancel,ifCreat:!1,onCreate:function(){return e.handleCreate()},formValues:this.state.formValues}):null,this.state.visiblePassword?S.a.createElement(q,{wrappedComponentRef:this.saveFormRef,visible:this.state.visiblePassword,onCancel:this.handleCancel,ifCreat:!1,onCreate:function(){return e.handleCreate()},formValues:this.state.formValues}):null)))}}]),t}(y.PureComponent);a.default=A}.call(this,t("yLpj"))},gtCd:function(e,a,t){e.exports={personalBox:"antd-pro-pages-user-personal-personalBox",firstSpan:"antd-pro-pages-user-personal-firstSpan",secondSpan:"antd-pro-pages-user-personal-secondSpan",emailBox:"antd-pro-pages-user-personal-emailBox",countDown:"antd-pro-pages-user-personal-countDown"}}}]);