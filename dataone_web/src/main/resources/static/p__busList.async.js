(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"56Lv":function(e,t,a){"use strict";a.r(t),function(e){a("DjyN");var n=a("NUBc"),o=(a("Telt"),a("Tckk")),s=(a("IzEo"),a("bx4M")),l=(a("Mwp2"),a("VXEj")),r=(a("MXD1"),a("CFYs")),i=(a("+L6B"),a("2/Rp")),c=(a("5Dmo"),a("3S7+")),d=(a("miYZ"),a("tsqr")),u=a("2Taf"),m=a.n(u),h=a("vZ4D"),g=a.n(h),f=a("l4Ni"),p=a.n(f),y=a("ujKo"),b=a.n(y),S=a("rlhR"),E=a.n(S),_=a("MhPg"),v=a.n(_),k=(a("Pwec"),a("CtXQ")),w=(a("2qtc"),a("kLXV")),z=(a("OaEy"),a("2fM7")),C=(a("5NDa"),a("5rEg")),x=a("q1tI"),j=a.n(x),I=a("usdK"),T=a.n(I),N=a("vDqi"),R=a.n(N),L=a("jHKv"),D=(a("kQFk"),a("w/s/")),F=a.n(D),P=a("yXo+"),M=a.n(P),A=a("/GGx"),J=a.n(A),U=a("gI1x"),V=a.n(U),W=(C.a.Search,z.a.Option),q=w.a.confirm,B=k.a.createFromIconfontCN({scriptUrl:e.constants.iconUrl}),X=function(t){function a(){var t;return m()(this,a),(t=p()(this,b()(a).apply(this,arguments))).state={dataSourceCard:[],pathurl:"/busList/watch",num0:0,num1:0,num2:0,num3:0,num4:0,num5:0,total:0,current:1,size:1==localStorage.getItem("role_id")?12:11,sizeRecord:1==localStorage.getItem("role_id")?12:11,flag:6,value:"",selectUser:[],selectDept:[],ifadmin:!1,isclick:!0,selectValue:0,loading:!1},t.loadDept=function(){var a=e.constants.httpType+e.constants.website+"/sys_user/alluser";t.setState({ifadmin:!1}),1==localStorage.getItem("role_id")&&(t.setState({ifadmin:!0}),a=e.constants.httpType+e.constants.website+"/sys_dept/dept_all/"),R()({method:"post",url:a,headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");var a=e.data.data;1==localStorage.getItem("role_id")?(a.unshift({dept_id:0,dept_name:"全部",count_user:null}),t.setState({selectDept:a})):(a.unshift({user_id:0,login_name:"全部",count_user:null}),t.setState({selectUser:a}))}).catch(function(e){})},t.loadList=function(a,n,o){t.setState({loading:!0}),t.setState({current:n,size:o,flag:6}),t.setState({deptId:a,selectValue:a});var s={current:n,size:o,deptId:a};R()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/selJobrelaByDeptIdPage/",data:L.a.Amap(s),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");var a=[""];if(1!=localStorage.getItem("role_id")&&3!=localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=e.data.data[n].id,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1}),t.loadNum()}).catch(function(e){d.a.error("接口异常")})},t.loadNum=function(){var a={deptId:void 0==t.state.deptId?0:t.state.deptId};R()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/jobrela_count/",data:L.a.Amap(a),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),t.setState({num4:e.data[0],num3:e.data[2],num2:e.data[1],num1:e.data[3],num0:e.data[4],num5:e.data[5]})}).catch(function(e){})},t.onchange1=function(a,n,o,s){t.setState({flag:n,current:o,loading:!0});var l={job_status:n,current:o,size:s,deptId:void 0==t.state.deptId?0:t.state.deptId};R()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/some_jobrela/",data:L.a.Amap(l),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");var a=[""];if(1!=localStorage.getItem("role_id")&&3!=localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=n,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1})}).catch(function(e){})},t.search=function(){t.setState({flag:7,loading:!0});var a={job_name:t.state.value,current:1,size:t.state.size};R()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/query_jobrela/",data:L.a.Amap(a),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");var a=[""];if(1!=localStorage.getItem("role_id")&&3!=localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=e.data.data[n].id,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1})}).catch(function(e){})},t.search1=function(a,n,o){t.setState({loading:!0});var s={job_name:a,current:t.state.current,size:t.state.size};R()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/query_jobrela/",data:L.a.Amap(s),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");var a=[""];if(1!=localStorage.getItem("role_id")&&3!=localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=e.data.data[n].id,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1})}).catch(function(e){})},t.reset=function(){t.setState({flag:6,selectValue:0,value:""}),t.loadList(0,1,t.state.size)},t.showModal=function(e){1!=localStorage.getItem("role_id")&&("00"==e?T.a.push("/busList/busCreat"):T.a.push("/busList/busCreat?n="+e))},t.btnStatue=function(e){return 5==e.job_status?[j.a.createElement(c.a,{title:1==localStorage.role_id||3==localStorage.role?"该任务还未创建激活成功，您暂无权限查看":null},j.a.createElement(i.a,{onClick:function(a){return a.stopPropagation(),t.showModal(e.id)},type:"primary",style:{width:90,background:"#fff"}},"去完善"))]:0==e.job_status?[j.a.createElement(i.a,{type:"primary",style:{width:90,background:"#fff",border:"1px solid #44bdf"}},"去激活")]:1==e.job_status||11==e.job_status?[j.a.createElement("span",null,j.a.createElement("span",{style:{color:"#02c58d",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"运行中"),j.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),j.a.createElement(r.a,{type:"circle",className:F.a.jinduColor1,percent:100*e.job_rate.toFixed(2),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,strokeColor:"#02c58d"})]:2==e.job_status||21==e.job_status?[j.a.createElement("span",null,j.a.createElement("span",{style:{color:"#4664b4",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"暂停中"),j.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),j.a.createElement(r.a,{className:F.a.jinduColor2,type:"circle",percent:100*e.job_rate.toFixed(2),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,style:{color:"red"},strokeColor:"#4664b4"})]:3==e.job_status||31==e.job_status?[j.a.createElement("span",null,j.a.createElement("span",{style:{color:"#db615d",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"已终止"),j.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),j.a.createElement(r.a,{className:F.a.jinduColor3,type:"circle",percent:100*e.job_rate.toFixed(2),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,style:{color:"red"},strokeColor:"#db615d"})]:4==e.job_status?[j.a.createElement("span",null,j.a.createElement("span",{style:{color:"#eca904",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"异常中"),j.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),j.a.createElement(r.a,{className:F.a.jinduColor4,type:"circle",percent:100*e.job_rate.toFixed(2),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,style:{color:"red"},strokeColor:"#eca904"})]:void 0},t.activeThing=function(a,n){a.stopPropagation();var o=E()(t);if(t.state.isclick){if(t.state.isclick){t.setState({isclick:!1});var s={id:n},l=e.constants.httpType+e.constants.website+"/sys_jobrela/start/";R()({method:"post",url:l,data:L.a.Amap(s),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status?(d.a.success(e.data.message),t.loadList(t.state.deptId,t.state.current,t.state.size)):d.a.error(e.data.message)}).catch(function(e){})}setTimeout(function(){o.setState({isclick:!0})},5e3)}},t.changePage=function(e,a){var n=E()(t);if(5==e){if(!t.state.isclick)return;if(t.state.isclick)return t.setState({isclick:!1}),d.a.warning("该任务等待完善中"),void setTimeout(function(){n.setState({isclick:!0})},3e3)}window.location.href="/busList/watch?n="+a},t.onChange=function(e,a){t.setState({current:e,size:a});var n=t.state.flag;if(6==n)t.loadList(t.state.deptId,e,a);else if(0==n||1==n||2==n||3==n||4==n||5==n)t.onchange1(event,n,e,a);else if(7==n){var o=t.state.value;t.search1(o,e,a)}},t.onShowSizeChange=function(e,a){t.setState({current:e,size:a});var n=t.state.flag;if(6==n)t.loadList(t.state.deptId,e,a);else if(0==n||1==n||2==n||3==n||4==n||5==n)t.onchange1(event,n,e,a);else if(7==n){var o=t.state.value;t.search1(o,e,a)}},t.deleteJob=function(e){var a=localStorage.getItem("role_id");if(t.setState({isclick:!1}),1==a){var n=E()(t);if(!t.state.isclick)return;return t.state.isclick&&d.a.error("权限不足"),void setTimeout(function(){n.setState({isclick:!0})},5e3)}q({title:"是否删除该任务？",onOk:function(){return t.deleteJobajax(e)},onCancel:function(){},cancelText:"取消",okText:"确认",centered:!0})},t.deleteJobajax=function(a){var n={id:a};R()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/delete_jobrela/",data:L.a.Amap(n),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user"),1==e.data.status?(d.a.success(e.data.message),T.a.push("/busList")):d.a.error(e.data.message),t.reset()}).catch(function(e){})},t}return v()(a,t),g()(a,[{key:"componentDidMount",value:function(){this.loadList(0,1,this.state.size),this.loadDept()}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){}}},{key:"render",value:function(){var e=this;return j.a.createElement("div",{style:{margin:"16px 16px 0 16px",background:"#fff",minHeight:687}},j.a.createElement("div",{style:{width:"80%",margin:"0px auto",overflow:"hidden"}},j.a.createElement("div",{className:F.a.searchHeader},j.a.createElement(z.a,{value:this.state.selectValue,onChange:function(t){return e.loadList(t,1,e.state.size)},style:{width:120,height:30,marginRight:10,display:1==localStorage.getItem("role_id")?"null":"none"}},this.state.selectDept.map(function(e,t){return j.a.createElement(W,{key:t,value:e.dept_id},e.dept_name)})),j.a.createElement(z.a,{value:this.state.selectValue,onChange:function(t){return e.loadList(t,1,e.state.size)},style:{width:120,height:30,display:2==localStorage.getItem("role_id")?"null":"none"}},this.state.selectUser.map(function(e,t){return j.a.createElement(W,{key:t,value:e.user_id},e.login_name)})),j.a.createElement("div",{className:F.a.SearchTitle},j.a.createElement(C.a,{prefix:j.a.createElement(B,{type:"iconsousuo",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"请输入任务名称关键字",className:F.a.searchSelect,onChange:function(t){e.setState({value:t.target.value})},value:this.state.value}),j.a.createElement(i.a,{className:F.a.but,onClick:this.search},"搜索"),j.a.createElement(i.a,{className:F.a.but,onClick:this.reset},"重置"))),j.a.createElement("ul",{className:F.a.searchBox},j.a.createElement("li",{className:F.a.spanTitle},"任务列表总览"),j.a.createElement("li",{className:F.a.searchCard,onClick:function(t){return e.onchange1(t,0,1,e.state.size)}},j.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",background:"#fff",float:"left"}},j.a.createElement(B,{type:"iconjihuo-copy",style:{fontSize:18,color:"#1890ff",padding:6}})),j.a.createElement("div",null,j.a.createElement("div",null,"待激活"),j.a.createElement("div",null,j.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num0),"个"))),j.a.createElement("li",{className:F.a.searchCard,onClick:function(t){return e.onchange1(t,5,1,e.state.size)}},j.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",background:"#fff",float:"left"}},j.a.createElement(B,{type:"iconbianjisekuai-copy",style:{fontSize:16,color:"#b1a3dc",padding:7}})),j.a.createElement("div",null,j.a.createElement("div",null,"待完善"),j.a.createElement("div",null,j.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num1),"个"))),j.a.createElement("li",{className:F.a.searchCard,onClick:function(t){return e.onchange1(t,3,1,e.state.size)}},j.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",background:"#fff",float:"left"}},j.a.createElement(B,{type:"icontingzhi",style:{fontSize:18,color:"#db615d",padding:6}})),j.a.createElement("div",null,j.a.createElement("div",null,"已终止"),j.a.createElement("div",null,j.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num5),"个"))),j.a.createElement("li",{className:F.a.searchCard,onClick:function(t){return e.onchange1(t,4,1,e.state.size)}},j.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",background:"#fff",float:"left"}},j.a.createElement(B,{type:"iconyichang-copy",style:{fontSize:24,color:"#eca904",padding:3}})),j.a.createElement("div",null,j.a.createElement("div",null,"异常中"),j.a.createElement("div",null,j.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,margin:"0 5px"}},this.state.num2),"个"))),j.a.createElement("li",{className:F.a.searchCard,onClick:function(t){return e.onchange1(t,2,1,e.state.size)}},j.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",background:"#fff",float:"left"}},j.a.createElement(B,{type:"iconzanting-copy",style:{fontSize:20,color:"#4664b4",padding:5}})),j.a.createElement("div",null,j.a.createElement("div",null,"暂停中"),j.a.createElement("div",null,j.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num3),"个"))),j.a.createElement("li",{className:F.a.searchCard,onClick:function(t){return e.onchange1(t,1,1,e.state.size)}},j.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",background:"#fff",float:"left"}},j.a.createElement(B,{type:"iconyunhangzhong-copy",style:{fontSize:19,color:"#02c58d",padding:6}})),j.a.createElement("div",null,j.a.createElement("div",null,"运行中"),j.a.createElement("div",null,j.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num4),"个")))),j.a.createElement(l.a,{rowKey:"id",className:F.a.departmentCard,grid:{gutter:24,xl:5,lg:4,md:3,sm:2,xs:1},dataSource:this.state.dataSourceCard,loading:this.state.loading,renderItem:function(t,a){return t?j.a.createElement(l.a.Item,null,j.a.createElement(s.a,{size:"small",hoverable:!0,className:F.a.listCard,title:j.a.createElement("div",{onClick:function(e){return e.stopPropagation()}},j.a.createElement("span",{style:{color:"#232D50"},title:t.job_name},t.job_name.length>12?t.job_name.slice(0,12)+"...":t.job_name),j.a.createElement(c.a,{title:j.a.createElement("span",{style:{float:"right",cursor:"pointer"},onClick:function(){e.deleteJob(t.id)}},"删除")},j.a.createElement(k.a,{style:{float:"right",marginTop:4},className:0==t.job_status||5==t.job_status?"showtarget":"hide",type:"ellipsis"}))),actions:e.btnStatue(t),onClick:function(){return e.changePage(t.job_status,t.id)},key:t.id},j.a.createElement("p",{style:{margin:0,fontSize:12,marginBottom:4},title:t.source_name},j.a.createElement(o.a,{src:1==t.source_type?M.a:V.a}),"   ",t.source_name.length>8?t.source_name.substring(0,8)+"...":t.source_name),j.a.createElement("p",{style:{margin:0,fontSize:12},title:t.dest_name},j.a.createElement(o.a,{src:1==t.dest_type?M.a:2==t.dest_type?V.a:J.a}),"   ",t.dest_name.length>8?t.dest_name.substring(0,8)+"...":t.dest_name))):j.a.createElement(l.a.Item,null,j.a.createElement(i.a,{type:"dashed",onClick:function(){return e.showModal("00")},style:{color:"#4e6fc6",height:"217px",width:"100%",background:"#F7F9FC"}},j.a.createElement(k.a,{type:"plus"})," 新建任务"))}}),j.a.createElement(n.a,{ref:"page",className:F.a.pagesCard,pageSizeOptions:[""+this.state.sizeRecord,""+2*this.state.sizeRecord,""+5*this.state.sizeRecord],showSizeChanger:!0,pagination:!0,style:{float:"right",marginBottom:10,background:"#fff"},onChange:this.onChange,onShowSizeChange:this.onShowSizeChange,current:this.state.current,defaultPageSize:this.state.size,total:this.state.total})))}}]),a}(x.PureComponent);t.default=X}.call(this,a("yLpj"))}}]);