(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"56Lv":function(e,t,a){"use strict";a.r(t),function(e){a("DjyN");var n=a("NUBc"),s=(a("Telt"),a("Tckk")),l=(a("IzEo"),a("bx4M")),o=(a("Mwp2"),a("VXEj")),r=(a("5NDa"),a("5rEg")),i=(a("miYZ"),a("tsqr")),c=(a("MXD1"),a("CFYs")),d=(a("+L6B"),a("2/Rp")),u=(a("5Dmo"),a("3S7+")),m=a("2Taf"),h=a.n(m),g=a("vZ4D"),p=a.n(g),f=a("l4Ni"),y=a.n(f),S=a("ujKo"),b=a.n(S),v=a("rlhR"),E=a.n(v),_=a("MhPg"),k=a.n(_),w=(a("2qtc"),a("kLXV")),C=(a("OaEy"),a("2fM7")),z=a("q1tI"),x=a.n(z),j=a("R+Pm"),I=a("zhj8"),T=a("xvlK"),N=a("3a4m"),R=a.n(N),L=a("vDqi"),D=a.n(L),P=a("jHKv"),M=(a("kQFk"),a("w/s/")),B=a.n(M),O=a("yXo+"),V=a.n(O),q=a("/GGx"),A=a.n(q),J=a("gI1x"),U=a.n(J),W=C.a.Option,H=w.a.confirm,F=Object(j.a)({scriptUrl:e.constants.iconUrl}),K=function(t){function a(){var t;return h()(this,a),(t=y()(this,b()(a).apply(this,arguments))).state={dataSourceCard:[],pathurl:"/busList/watch",num0:0,num1:0,num2:0,num3:0,num4:0,num5:0,total:0,current:1,size:"1"===localStorage.getItem("role_id")?12:11,sizeRecord:"1"===localStorage.getItem("role_id")?["12","24","48"]:["11","23","47"],flag:6,value:"",selectUser:[],selectDept:[],ifadmin:!1,isclick:!0,selectValue:0,loading:!1},t.loadDept=function(){var a=e.constants.httpType+e.constants.website+"/sys_user/alluser";t.setState({ifadmin:!1}),"1"===localStorage.getItem("role_id")&&(t.setState({ifadmin:!0}),a=e.constants.httpType+e.constants.website+"/sys_dept/dept_all/"),D()({method:"post",url:a,headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"==e.data.status&&(window.location.href="/user");var a=e.data.data;"1"===localStorage.getItem("role_id")?(a.unshift({dept_id:0,dept_name:"全部",count_user:null}),t.setState({selectDept:a})):(a.unshift({user_id:0,login_name:"全部",count_user:null}),t.setState({selectUser:a}))}).catch(function(e){})},t.loadList=function(a,n,s){t.setState({loading:!0}),t.setState({current:n,size:s,flag:6}),t.setState({deptId:a,selectValue:a});var l={current:n,size:s,deptId:a};D()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/selJobrelaByDeptIdPage/",data:P.a.Amap(l),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"===e.data.status&&(window.location.href="/user");var a=[""];if("1"!==localStorage.getItem("role_id")&&"3"!==localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=e.data.data[n].id,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1}),t.loadNum()}).catch(function(e){})},t.loadNum=function(){var a={deptId:void 0===t.state.deptId?0:t.state.deptId};D()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/jobrela_count/",data:P.a.Amap(a),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"===e.data.status&&(window.location.href="/user"),t.setState({num4:e.data[0],num3:e.data[2],num2:e.data[1],num1:e.data[3],num0:e.data[4],num5:e.data[5]})}).catch(function(e){})},t.onchange1=function(a,n,s,l){t.setState({flag:n,current:s,loading:!0});var o={job_status:n,current:s,size:l,deptId:void 0===t.state.deptId?0:t.state.deptId};D()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/some_jobrela/",data:P.a.Amap(o),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"===e.data.status&&(window.location.href="/user");var a=[""];if("1"!==localStorage.getItem("role_id")&&"3"!==localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=n,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1})}).catch(function(e){})},t.search=function(){t.setState({flag:7,loading:!0});var a={job_name:t.state.value,current:1,size:t.state.size};D()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/query_jobrela/",data:P.a.Amap(a),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"===e.data.status&&(window.location.href="/user");var a=[""];if("1"!==localStorage.getItem("role_id")&&"3"!==localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=e.data.data[n].id,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1})}).catch(function(e){})},t.search1=function(a,n,s){t.setState({loading:!0});var l={job_name:a,current:t.state.current,size:t.state.size};D()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/query_jobrela/",data:P.a.Amap(l),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"===e.data.status&&(window.location.href="/user");var a=[""];if("1"!==localStorage.getItem("role_id")&&"3"!==localStorage.getItem("role_id")||(a=[]),1==e.data.status)for(var n=0;n<e.data.data.length;n++)e.data.data[n].key=e.data.data[n].id,a.push(e.data.data[n]);t.setState({dataSourceCard:a,total:e.data.totalCount,loading:!1})}).catch(function(e){})},t.reset=function(){t.setState({flag:6,selectValue:0,value:""}),t.loadList(0,1,t.state.size)},t.showModal=function(e){"1"!==localStorage.getItem("role_id")&&("00"===e?R.a.push("/busList/busCreat"):R.a.push("/busList/busCreat?n="+e))},t.btnStatue=function(e,a){return 5==e.job_status?[x.a.createElement(u.a,{key:a,title:"1"===localStorage.role_id||"3"===localStorage.role_id?"该任务还未创建激活成功，您暂无权限查看":null},x.a.createElement(d.a,{onClick:function(a){return a.stopPropagation(),t.showModal(e.id)},type:"primary",style:{width:90,background:"#fff"}},"去完善"))]:0==e.job_status?[x.a.createElement(u.a,{title:1==localStorage.role_id?"该任务还未创建激活成功，您暂无权限查看":null},x.a.createElement(d.a,{type:"primary",style:{width:90,background:"#fff",border:"1px solid #44bdf"}},"去激活"))]:1==e.job_status||11==e.job_status?[x.a.createElement("span",null,x.a.createElement("span",{style:{color:"#02c58d",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"运行中"),x.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),x.a.createElement(c.a,{type:"circle",className:B.a.jinduColor1,percent:parseInt(100*e.job_rate),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,strokeColor:"#02c58d"})]:2==e.job_status||21==e.job_status?[x.a.createElement("span",null,x.a.createElement("span",{style:{color:"#4664b4",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"暂停中"),x.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),x.a.createElement(c.a,{className:B.a.jinduColor2,type:"circle",percent:parseInt(100*e.job_rate),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,style:{color:"red"},strokeColor:"#4664b4"})]:3==e.job_status||31==e.job_status?[x.a.createElement("span",null,x.a.createElement("span",{style:{color:"#db615d",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"已终止"),x.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),x.a.createElement(c.a,{className:B.a.jinduColor3,type:"circle",percent:parseInt(100*e.job_rate),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,style:{color:"red"},strokeColor:"#db615d"})]:4==e.job_status?[x.a.createElement("span",null,x.a.createElement("span",{style:{color:"#eca904",width:62,display:"block",margin:"5px 20px 0",letterSpacing:"5px",fontSize:14}},"异常中"),x.a.createElement("span",{style:{fontSize:12,color:"rgba(35, 45, 80, 0.8)",letterSpacing:1,width:62,margin:"5px 20px 0",display:"block"}},1==e.sync_range?"全量":2==e.sync_range?"增量同步":3==e.sync_range?"全量+增量":"存量同步")),x.a.createElement(c.a,{className:B.a.jinduColor4,type:"circle",percent:parseInt(100*e.job_rate),format:function(e){return 100==e?"100%":"".concat(e,"%")},width:60,style:{color:"red"},strokeColor:"#eca904"})]:void 0},t.activeThing=function(a,n){a.stopPropagation();var s=E()(t);if(t.state.isclick){if(t.state.isclick){t.setState({isclick:!1});var l={id:n},o=e.constants.httpType+e.constants.website+"/sys_jobrela/start/";D()({method:"post",url:o,data:P.a.Amap(l),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"===e.data.status&&(window.location.href="/user"),1==e.data.status?(i.a.success(e.data.message,2),t.loadList(t.state.deptId,t.state.current,t.state.size)):i.a.error(e.data.message,2)}).catch(function(e){})}setTimeout(function(){s.setState({isclick:!0})},3e3)}},t.changePage=function(e,a){var n=E()(t);if(5==e||0==e&&"1"===localStorage.getItem("role_id")){if(!t.state.isclick)return;if(t.state.isclick)return t.setState({isclick:!1}),5==e?i.a.warning("该任务等待完善中",2):i.a.warning("该任务暂未激活",2),void setTimeout(function(){n.setState({isclick:!0})},2e3)}window.location.href="/busList/watch?n="+a},t.onChange=function(e,a){t.setState({current:e,size:a});var n=t.state.flag;if(6==n)t.loadList(t.state.deptId,e,a);else if(0==n||1==n||2==n||3==n||4==n||5==n)t.onchange1(event,n,e,a);else if(7==n){var s=t.state.value;t.search1(s,e,a)}},t.onShowSizeChange=function(e,a){t.setState({current:e,size:a});var n=t.state.flag;if(6==n)t.loadList(t.state.deptId,e,a);else if(0==n||1==n||2==n||3==n||4==n||5==n)t.onchange1(event,n,e,a);else if(7==n){var s=t.state.value;t.search1(s,e,a)}},t.deleteJob=function(e){var a=localStorage.getItem("role_id");if(t.setState({isclick:!1}),1==a){var n=E()(t);if(!t.state.isclick)return;return t.state.isclick&&i.a.error("权限不足",2),void setTimeout(function(){n.setState({isclick:!0})},3e3)}H({title:"是否删除该任务？",onOk:function(){return t.deleteJobajax(e)},onCancel:function(){},cancelText:"取消",okText:"确认",centered:!0})},t.deleteJobajax=function(a){var n={id:a};D()({method:"post",url:e.constants.httpType+e.constants.website+"/sys_jobrela/delete_jobrela/",data:P.a.Amap(n),headers:{authToken:localStorage.getItem("authToken")}}).then(function(e){"401"===e.data.status&&(window.location.href="/user"),1==e.data.status?(i.a.success(e.data.message,2),R.a.push("/busList")):i.a.error(e.data.message,2),t.reset()}).catch(function(e){})},t}return k()(a,t),p()(a,[{key:"componentDidMount",value:function(){this.loadList(0,1,this.state.size),this.loadDept()}},{key:"componentWillUnmount",value:function(){this.setState=function(e,t){}}},{key:"render",value:function(){var e=this;return x.a.createElement("div",{style:{margin:"16px 16px 0 16px",background:"#fff",minHeight:687}},x.a.createElement("div",{style:{width:"80%",margin:"0px auto"}},x.a.createElement("div",{className:B.a.searchHeader},x.a.createElement(C.a,{value:this.state.selectValue,onChange:function(t){return e.loadList(t,1,e.state.size)},style:{width:120,height:30,marginRight:10,display:1==localStorage.getItem("role_id")?"null":"none"}},this.state.selectDept.map(function(e,t){return x.a.createElement(W,{key:t,value:e.dept_id},e.dept_name)})),x.a.createElement(C.a,{value:this.state.selectValue,onChange:function(t){return e.loadList(t,1,e.state.size)},style:{width:120,height:30,display:2==localStorage.getItem("role_id")?"null":"none"}},this.state.selectUser.map(function(e,t){return x.a.createElement(W,{key:t,value:e.user_id},e.login_name)})),x.a.createElement("div",{className:B.a.SearchTitle},x.a.createElement(r.a,{onPressEnter:this.search,prefix:x.a.createElement(F,{type:"iconsousuo",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"请输入任务名称关键字",className:B.a.searchSelect,onChange:function(t){e.setState({value:t.target.value})},value:this.state.value}),x.a.createElement(d.a,{className:B.a.but,onClick:this.search},"搜索"),x.a.createElement(d.a,{className:B.a.but,onClick:this.reset},"重置"))),x.a.createElement("ul",{className:B.a.searchBox},x.a.createElement("li",{className:B.a.spanTitle},"任务列表总览"),x.a.createElement("li",{className:B.a.searchCard,onClick:function(t){return e.onchange1(t,0,1,e.state.size)}},x.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",float:"left"}}),x.a.createElement("div",null,x.a.createElement("div",null,"待激活"),x.a.createElement("div",null,x.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num0),"个"))),x.a.createElement("li",{className:B.a.searchCard,onClick:function(t){return e.onchange1(t,5,1,e.state.size)}},x.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",float:"left"}}),x.a.createElement("div",null,x.a.createElement("div",null,"待完善"),x.a.createElement("div",null,x.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num1),"个"))),x.a.createElement("li",{className:B.a.searchCard,onClick:function(t){return e.onchange1(t,3,1,e.state.size)}},x.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",float:"left"}}),x.a.createElement("div",null,x.a.createElement("div",null,"已终止"),x.a.createElement("div",null,x.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num5),"个"))),x.a.createElement("li",{className:B.a.searchCard,onClick:function(t){return e.onchange1(t,4,1,e.state.size)}},x.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",float:"left"}}),x.a.createElement("div",null,x.a.createElement("div",null,"异常中"),x.a.createElement("div",null,x.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,margin:"0 5px"}},this.state.num2),"个"))),x.a.createElement("li",{className:B.a.searchCard,onClick:function(t){return e.onchange1(t,2,1,e.state.size)}},x.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",float:"left"}}),x.a.createElement("div",null,x.a.createElement("div",null,"暂停中"),x.a.createElement("div",null,x.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num3),"个"))),x.a.createElement("li",{className:B.a.searchCard,onClick:function(t){return e.onchange1(t,1,1,e.state.size)}},x.a.createElement("div",{style:{width:30,height:30,margin:"10px 5px",borderRadius:"50%",float:"left"}}),x.a.createElement("div",null,x.a.createElement("div",null,"运行中"),x.a.createElement("div",null,x.a.createElement("span",{style:{color:"#fff",fontSize:18,fontWeight:600,marginRight:5}},this.state.num4),"个")))),x.a.createElement(o.a,{rowKey:"id",className:B.a.departmentCard,grid:{gutter:24,xl:5,lg:4,md:3,sm:2,xs:1},dataSource:this.state.dataSourceCard,loading:this.state.loading,renderItem:function(t,a){return t?x.a.createElement(o.a.Item,null,x.a.createElement(l.a,{size:"small",hoverable:!0,className:B.a.listCard,title:x.a.createElement("div",{onClick:function(e){return e.stopPropagation()}},x.a.createElement("span",{style:{color:"#232D50",fontSize:14},title:t.job_name},t.job_name.length>12?t.job_name.slice(0,12)+"...":t.job_name),x.a.createElement(u.a,{title:x.a.createElement("span",{style:{float:"right",cursor:"pointer"},onClick:function(){e.deleteJob(t.id)}},"删除")},2==localStorage.role_id&&x.a.createElement(I.a,{style:{float:"right",marginTop:4},className:0==t.job_status||5==t.job_status?"showtarget":"hide"}))),actions:e.btnStatue(t),onClick:function(){return e.changePage(t.job_status,t.id)},key:t.id},x.a.createElement("p",{style:{margin:0,fontSize:12,marginBottom:4},title:t.source_name},x.a.createElement(s.a,{src:1==t.source_type?V.a:U.a}),"   ",t.source_name.length>8?t.source_name.substring(0,8)+"...":t.source_name),x.a.createElement("p",{style:{margin:0,fontSize:12},title:t.dest_name},x.a.createElement(s.a,{src:1==t.dest_type?V.a:2==t.dest_type?U.a:A.a}),"   ",t.dest_name.length>8?t.dest_name.substring(0,8)+"...":t.dest_name))):x.a.createElement(o.a.Item,null,x.a.createElement(d.a,{type:"dashed",onClick:function(){return e.showModal("00")},style:{color:"#071728",height:"217px",width:"100%",background:"#F7F9FC"}},x.a.createElement(T.a,null)," 新建任务"))}}),x.a.createElement(n.a,{ref:"page",className:B.a.pagesCard,pageSizeOptions:this.state.sizeRecord,showSizeChanger:!0,hideOnSinglePage:!0,style:{float:"right",marginBottom:10,background:"#fff"},onChange:this.onChange,onShowSizeChange:this.onShowSizeChange,current:this.state.current,defaultPageSize:this.state.size,total:this.state.total})))}}]),a}(z.PureComponent);t.default=K}.call(this,a("yLpj"))},zhj8:function(e,t,a){"use strict";var n=a("q1tI"),s=a.n(n),l={name:"dash",theme:"outlined",icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M112 476h160v72H112zm320 0h160v72H432zm320 0h160v72H752z"}}]}},o=a("6VBw"),r=function(e,t){return s.a.createElement(o.a,Object.assign({},e,{ref:t,icon:l}))};r.displayName="DashOutlined";t.a=s.a.forwardRef(r)}}]);